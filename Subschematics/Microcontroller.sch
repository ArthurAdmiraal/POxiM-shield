EESchema Schematic File Version 4
LIBS:POxiM-wristcomputer-cache
EELAYER 29 0
EELAYER END
$Descr A4 11693 8268
encoding utf-8
Sheet 6 6
Title "Microcontroller"
Date "2020-06-10"
Rev "A"
Comp "POxiM"
Comment1 "By Arthur Admiraal & Daan de Groot"
Comment2 "Performs signal processing and control"
Comment3 ""
Comment4 ""
$EndDescr
Wire Wire Line
	6000 4850 6000 4950
Wire Wire Line
	5150 4800 5150 4950
Connection ~ 5150 4950
Wire Wire Line
	5150 4950 4650 4950
Wire Wire Line
	5400 4450 4650 4450
Connection ~ 4650 4950
Wire Wire Line
	4650 4950 4600 4950
Wire Wire Line
	5150 2750 5150 2850
Wire Wire Line
	5150 2850 4700 2850
Wire Wire Line
	4700 2750 4700 2850
Wire Wire Line
	6000 2450 5600 2450
Wire Wire Line
	4700 2450 4700 2550
Wire Wire Line
	5150 2550 5150 2450
Wire Wire Line
	5150 2450 4700 2450
Wire Wire Line
	5600 2550 5600 2450
Connection ~ 5600 2450
Wire Wire Line
	5600 2450 5150 2450
Wire Wire Line
	5600 2750 5600 2850
$Comp
L Device:Ferrite_Bead_Small FB1
U 1 1 5EBC4A36
P 4550 2450
F 0 "FB1" V 4313 2450 50  0000 C CNN
F 1 "220Ω @ 100MHz" V 4404 2450 50  0000 C CNN
F 2 "Inductor_SMD:L_0603_1608Metric" V 4480 2450 50  0001 C CNN
F 3 "~" H 4550 2450 50  0001 C CNN
F 4 "Murata Electronics" V 4550 2450 50  0001 C CNN "Mfr."
F 5 "BLM18KG221BH1D" V 4550 2450 50  0001 C CNN "Mfr. No."
F 6 "81-BLM18KG221BH1D" V 4550 2450 50  0001 C CNN "Mouser No."
	1    4550 2450
	0    1    1    0   
$EndComp
$Comp
L Device:C_Small C8
U 1 1 5EBC882D
P 5150 2650
F 0 "C8" H 5250 2700 50  0000 L CNN
F 1 "100nF" H 5250 2600 50  0000 L CNN
F 2 "Capacitor_SMD:C_0603_1608Metric" H 5150 2650 50  0001 C CNN
F 3 "~" H 5150 2650 50  0001 C CNN
F 4 "Murata Electronics" H 5150 2650 50  0001 C CNN "Mfr."
F 5 "GCJ188R71E104KA12D" H 5150 2650 50  0001 C CNN "Mfr. No."
F 6 "81-GCJ188R71E104KA2D" H 5150 2650 50  0001 C CNN "Mouser No."
	1    5150 2650
	1    0    0    -1  
$EndComp
$Comp
L Device:C_Small C6
U 1 1 5EBC898E
P 4700 2650
F 0 "C6" H 4800 2700 50  0000 L CNN
F 1 "2.2µF" H 4800 2600 50  0000 L CNN
F 2 "Capacitor_SMD:C_0805_2012Metric" H 4700 2650 50  0001 C CNN
F 3 "~" H 4700 2650 50  0001 C CNN
F 4 "Murata Electronics" H 4700 2650 50  0001 C CNN "Mfr."
F 5 "GCM21BR71E225KA73L" H 4700 2650 50  0001 C CNN "Mfr. No."
F 6 "81-GCM21BR71E225KA3L" H 4700 2650 50  0001 C CNN "Mouser No."
	1    4700 2650
	1    0    0    -1  
$EndComp
$Comp
L Device:C_Small C7
U 1 1 5EBCB357
P 5150 4700
F 0 "C7" H 5050 4750 50  0000 R CNN
F 1 "470nF" H 5050 4650 50  0000 R CNN
F 2 "Capacitor_SMD:C_0603_1608Metric" H 5150 4700 50  0001 C CNN
F 3 "~" H 5150 4700 50  0001 C CNN
F 4 "Murata Electronics" H 5150 4700 50  0001 C CNN "Mfr."
F 5 "GCM188R71E474KA64D" H 5150 4700 50  0001 C CNN "Mfr. No."
F 6 "81-GCM188R71E474KA4D" H 5150 4700 50  0001 C CNN "Mouser No."
	1    5150 4700
	1    0    0    -1  
$EndComp
Text Label 7150 3550 2    50   ~ 0
SWIM
Text Label 7150 4050 2    50   ~ 0
ADC_in
Text Label 4900 3950 0    50   ~ 0
LED_R
Text Label 4900 3850 0    50   ~ 0
LED_IR
Text Notes 7200 4050 0    50   ~ 0
AIN6
Text Label 7150 3850 2    50   ~ 0
ADC_feedback
Text Notes 7200 3850 0    50   ~ 0
TIM2_CH1
Text Label 5150 4450 0    50   ~ 0
NRST
Text Label 5150 4550 0    50   ~ 0
VCAP
Text HLabel 4600 4950 0    50   Input ~ 0
GND
Text HLabel 4400 2450 0    50   Input ~ 0
5V
Wire Wire Line
	4650 2450 4700 2450
Connection ~ 4700 2450
Entry Wire Line
	4700 3750 4800 3650
Entry Wire Line
	4700 3650 4800 3550
Entry Wire Line
	4700 3450 4800 3350
Entry Wire Line
	4700 3350 4800 3250
Entry Wire Line
	4700 3250 4800 3150
$Comp
L Device:C_Small C9
U 1 1 5EC2C4C9
P 5600 2650
F 0 "C9" H 5700 2700 50  0000 L CNN
F 1 "100nF" H 5700 2600 50  0000 L CNN
F 2 "Capacitor_SMD:C_0603_1608Metric" H 5600 2650 50  0001 C CNN
F 3 "~" H 5600 2650 50  0001 C CNN
F 4 "Murata Electronics" H 5600 2650 50  0001 C CNN "Mfr."
F 5 "GCJ188R71E104KA12D" H 5600 2650 50  0001 C CNN "Mfr. No."
F 6 "81-GCJ188R71E104KA2D" H 5600 2650 50  0001 C CNN "Mouser No."
	1    5600 2650
	1    0    0    -1  
$EndComp
Text HLabel 4450 4350 0    50   Output ~ 0
Segment[0..6]
Text Label 4900 3150 0    50   ~ 0
Segment0
Text Label 4900 3250 0    50   ~ 0
Segment1
Text Label 4900 3350 0    50   ~ 0
Segment2
Text Label 4900 3550 0    50   ~ 0
Segment3
Text Label 4900 3650 0    50   ~ 0
Segment4
Text Label 4900 4050 0    50   ~ 0
Segment5
Text Label 4900 4150 0    50   ~ 0
Segment6
Text Label 7150 3650 2    50   ~ 0
Common0
Text Label 7150 3750 2    50   ~ 0
Common1
Entry Wire Line
	4700 4150 4800 4050
Entry Wire Line
	4700 4250 4800 4150
Text HLabel 9100 3450 2    50   Output ~ 0
Common[0..2]
Text Label 7150 3950 2    50   ~ 0
UART1_TX
Text HLabel 7600 3850 2    50   Output ~ 0
ADC.feedback
Text HLabel 7600 4050 2    50   Input ~ 0
ADC.input
Wire Wire Line
	6600 3950 7600 3950
Wire Wire Line
	6600 3550 7600 3550
Text HLabel 7600 3550 2    50   BiDi ~ 0
SWIM
Text HLabel 4450 3950 0    50   Output ~ 0
LED.Red
Text HLabel 4450 3850 0    50   Output ~ 0
LED.IR
Text HLabel 7600 3950 2    50   Output ~ 0
UART1.TX
Text Notes 4000 4000 2    50   ~ 0
TIM1_CH4
Text Notes 4000 3900 2    50   ~ 0
TIM1_CH3
$Comp
L MCU_ST_STM8:STM8S003F3P U2
U 1 1 5EBBDDDF
P 6000 3850
F 0 "U2" H 6050 4900 50  0000 L CNN
F 1 "STM8S003F3P" H 6050 4800 50  0000 L CNN
F 2 "Package_SO:TSSOP-20_4.4x6.5mm_P0.65mm" H 6050 4950 50  0001 L CNN
F 3 "http://www.st.com/st-web-ui/static/active/en/resource/technical/document/datasheet/DM00024550.pdf" H 5950 3450 50  0001 C CNN
F 4 "STMicroelectronics" H 6000 3850 50  0001 C CNN "Mfr."
F 5 "STM8S003F3P6" H 6000 3850 50  0001 C CNN "Mfr. No."
F 6 "511-STM8S003F3P6" H 6000 3850 50  0001 C CNN "Mouser No."
	1    6000 3850
	1    0    0    -1  
$EndComp
Entry Wire Line
	8850 3750 8950 3650
Entry Wire Line
	8850 3650 8950 3550
Text HLabel 4400 2850 0    50   Input ~ 0
GND
Wire Wire Line
	5150 2850 5600 2850
Wire Wire Line
	4400 2850 4700 2850
Connection ~ 4700 2850
Wire Wire Line
	5150 4950 6000 4950
Connection ~ 5150 2850
Connection ~ 5150 2450
Wire Wire Line
	6000 2850 6000 2450
Wire Wire Line
	4400 2450 4450 2450
Wire Wire Line
	4650 4800 4650 4950
Wire Wire Line
	4650 4450 4650 4600
$Comp
L Device:C_Small C5
U 1 1 5EC2C862
P 4650 4700
F 0 "C5" H 4550 4750 50  0000 R CNN
F 1 "100nF" H 4550 4650 50  0000 R CNN
F 2 "Capacitor_SMD:C_0603_1608Metric" H 4650 4700 50  0001 C CNN
F 3 "~" H 4650 4700 50  0001 C CNN
F 4 "Murata Electronics" H 4650 4700 50  0001 C CNN "Mfr."
F 5 "GCJ188R71E104KA12D" H 4650 4700 50  0001 C CNN "Mfr. No."
F 6 "81-GCJ188R71E104KA2D" H 4650 4700 50  0001 C CNN "Mouser No."
	1    4650 4700
	1    0    0    -1  
$EndComp
Wire Wire Line
	5150 4600 5150 4550
Wire Wire Line
	5150 4550 5400 4550
Wire Bus Line
	4650 4350 4450 4350
Wire Wire Line
	4800 4050 5400 4050
Wire Wire Line
	4800 4150 5400 4150
Wire Wire Line
	4800 3150 5400 3150
Wire Wire Line
	4800 3250 5400 3250
Wire Wire Line
	4800 3550 5400 3550
Wire Wire Line
	4800 3650 5400 3650
Wire Wire Line
	4800 3350 5400 3350
Wire Bus Line
	4700 4300 4650 4350
Text Label 4900 4250 0    50   ~ 0
Common2
Wire Wire Line
	4900 4250 5400 4250
Wire Wire Line
	7150 3750 6600 3750
Wire Wire Line
	6600 3650 7150 3650
Wire Wire Line
	6600 4050 7600 4050
Wire Wire Line
	6600 3850 7600 3850
Text Label 8400 3650 0    50   ~ 0
Common0
Text Label 8400 3750 0    50   ~ 0
Common1
Wire Wire Line
	8400 3750 8850 3750
Wire Wire Line
	8850 3650 8400 3650
Text Label 8400 3850 0    50   ~ 0
Common2
Entry Wire Line
	8850 3850 8950 3750
Wire Wire Line
	8400 3850 8850 3850
Wire Bus Line
	9000 3450 9100 3450
Wire Bus Line
	8950 3500 9000 3450
Wire Wire Line
	4450 3850 5400 3850
Wire Wire Line
	4450 3950 5400 3950
Text Notes 1350 3550 0    50   ~ 0
Two-level 6.4KHz PWM modulated by 16-level sine with 166 levels of brightness\nscaling. The frequencies are chosen such that the harmonics lay outside the\nband of interest. The 16-levels ensure harmonics are 60dB down for reduced\nEMI concerns. The red LED has the highest modulation frequency to reduce \nthe perception of flicker, since it is at a visible wavelength.
Text Notes 3500 3900 2    50   ~ 0
80Hz
Text Notes 3500 4000 2    50   ~ 0
128Hz
Wire Notes Line
	3200 4050 3200 3750
Wire Notes Line
	3200 3750 4500 3750
Wire Notes Line
	4500 4050 3200 4050
Wire Notes Line
	4500 3750 4500 4050
Wire Bus Line
	1300 3100 4550 3100
Wire Bus Line
	4550 3100 4550 3600
Wire Bus Line
	4550 3600 1300 3600
Wire Bus Line
	1300 3600 1300 3100
Wire Notes Line
	4550 3600 4500 3750
Wire Bus Line
	4600 5200 7700 5200
Wire Bus Line
	7700 5200 7700 5700
Wire Bus Line
	7700 5700 4600 5700
Text Notes 4650 5650 0    50   ~ 0
100nF capacitors could be replaced with 470nF for BOM consolidation, but \nsince we’re still far under the maximum unique part count of most \nassemblers, we keep the 100nF capacitors, which are 25% cheaper at scale. \nFor production quantities > 1000, it is also not worth replacing the 470nF \ncapacitor with 5 100nF capacitors.
Wire Notes Line
	4800 4600 5250 4600
Wire Notes Line
	5250 4600 5250 4800
Wire Notes Line
	5250 4800 4800 4800
Wire Notes Line
	4800 4800 4800 4600
Wire Notes Line
	4600 5200 4800 4800
Wire Bus Line
	4600 5700 4600 5200
Wire Bus Line
	8950 3500 8950 3750
Wire Bus Line
	4700 3250 4700 4300
$EndSCHEMATC
